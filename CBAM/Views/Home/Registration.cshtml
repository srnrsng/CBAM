@{
    ViewData["Title"] = "Register Installation - Step 3 (CBAM Portal)";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    :root {
        --brand: #1f4e79;
        --brand-dark: #173b5c;
        --muted: #6c757d;
        --bg: #f4f6f9;
        --card: #ffffff;
        --radius: 12px;
    }

    body { background: var(--bg); font-family: "Segoe UI", sans-serif; margin:0; padding:0; }

    .page {
        width: 100%;
        min-height: 100vh;
        padding: 48px 20px;
        display: flex;
        justify-content: center;
    }

    .card {
        width: 100%;
        max-width: 1200px;
        background: var(--card);
        border-radius: var(--radius);
        box-shadow: 0 10px 30px rgba(16, 30, 50, 0.07);
        padding: 32px;
    }

    h2 { margin: 0; color: var(--brand); font-size: 22px; font-weight: 700; }
    .subtitle { color: var(--muted); font-size: 14px; margin-bottom: 20px; }

    .grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px 20px;
    }

    label {
        display: block;
        font-weight: 600;
        margin-bottom: 4px;
        color: #22344d;
    }

    input, textarea, select {
        width: 100%;
        height: 48px;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid #e6e9ee;
        font-size: 15px;
        transition: .2s;
    }

    textarea { height: 90px; resize: vertical; }

    input:focus, textarea:focus, select:focus {
        border-color: var(--brand);
        box-shadow: 0px 0px 8px rgba(31,78,121,0.25);
        outline: none;
    }

    .full { grid-column: 1 / -1; }

    .btn-primary {
        background: var(--brand);
        border: none;
        color: white;
        padding: 14px 26px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        margin-top: 20px;
    }

    .btn-primary:hover { background: var(--brand-dark); }

    .btn-secondary {
        border: 1px solid #d1d8e0;
        background: white;
        color: var(--brand);
        padding: 12px 20px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
    }

    /* Plant Manager */
    .plants-box {
        margin-top: 25px;
        padding: 18px;
        border-radius: 10px;
        border: 1px solid #e8eef5;
        background: #ffffff;
    }

    .plants-row {
        display: flex;
        flex-wrap: wrap;
        gap: 14px;
    }

    .plants-col { flex: 1 1 260px; }

    .plant-list {
        margin-top: 16px;
        border-top: 1px dashed #d8e1ec;
        padding-top: 12px;
    }

    .plant-item {
        background: #ffffff;
        border: 1px solid #dfe6ef;
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
    }

    .remove-btn {
        border: none;
        background: transparent;
        color: #c62828;
        cursor: pointer;
        font-weight: 700;
    }

    .summary-box {
        margin-top: 25px;
        padding: 16px;
        background: #f7faff;
        border: 1px solid #d9e6f7;
        border-radius: 10px;
        display: none;
    }

    @@media(max-width: 900px) {
        .grid { grid-template-columns: 1fr; }
        .plants-row { flex-direction: column; }
    }
</style>

<div class="page">
    <div class="card">

        <h2>Register Installation – Step 3</h2>
        <div class="subtitle">Enter installation details and define plants & products</div>

        <form method="post" asp-controller="Account" asp-action="RegisterStep3" id="formStep3">

            <div class="grid">

                <div class="full">
                    <label>Register Installation Admin</label>
                    <input type="text" name="InstallationAdmin" placeholder="e.g. John Doe" required />
                </div>

                <div class="full">
                    <label>Name of Installation</label>
                    <input type="text" name="InstallationName" placeholder="e.g. ACME Steel Unit 3" required />
                </div>

                <div class="full">
                    <label>Physical Address</label>
                    <textarea name="PhysicalAddress" placeholder="Street, Building, Area" required></textarea>
                </div>

                <div>
                    <label>Economic Activity</label>
                    <select name="InstallationActivity" required>
                        <option value="">Select activity</option>
                        <option>Manufacturing – Steel</option>
                        <option>Manufacturing – Cement</option>
                        <option>Manufacturing – Chemicals</option>
                        <option>Trading / Import</option>
                        <option>Logistics</option>
                    </select>
                </div>

                <div>
                    <label>Post Code</label>
                    <input type="text" name="PostCode" />
                </div>

                <div>
                    <label>City</label>
                    <input type="text" name="City" />
                </div>

                <div>
                    <label>UNLOCODE</label>
                    <input type="text" name="UNLOCODE" placeholder="e.g. INNSA" />
                </div>

                <div>
                    <label>Latitude</label>
                    <input type="text" name="Latitude" placeholder="e.g. 19.0760" />
                </div>

                <div>
                    <label>Longitude</label>
                    <input type="text" name="Longitude" placeholder="e.g. 72.8777" />
                </div>

            </div>

            <!-- Plant Manager -->
            <div class="plants-box">

                <h3 style="color:#1f4e79; margin-bottom:10px;">Plants & Products</h3>

                <div class="plants-row">
                    <div class="plants-col">
                        <label>Plant Name</label>
                        <input id="plantName" type="text" placeholder="e.g. Furnace 1" />
                    </div>

                    <div class="plants-col">
                        <label>Products (comma-separated)</label>
                        <input id="plantProducts" type="text" placeholder="e.g. HRC, CRC, Pig Iron" />
                    </div>

                    <div style="display:flex; gap:10px;">
                        <button type="button" class="btn-primary" id="btnAddPlant" style="height:48px;">Add</button>
                        <button type="button" class="btn-secondary" id="btnClear">Clear</button>
                    </div>
                </div>

                <!-- Output -->
                <div id="plantList" class="plant-list">
                    <div class="subtitle">No plants added yet.</div>
                </div>

                <input type="hidden" id="PlantsJson" name="PlantsJson" />
            </div>

            <!-- Summary -->
            <div class="summary-box" id="summaryBox">
                <h4 style="margin-top:0;">Summary</h4>
                <div id="summaryContent"></div>
            </div>

            <button type="submit" class="btn-primary">Save & Continue</button>
        </form>
    </div>
</div>

<script>
    const plants = [];

    const plantName = document.getElementById("plantName");
    const plantProducts = document.getElementById("plantProducts");
    const plantList = document.getElementById("plantList");
    const plantsJson = document.getElementById("PlantsJson");
    const summaryBox = document.getElementById("summaryBox");
    const summaryContent = document.getElementById("summaryContent");

    document.getElementById("btnAddPlant").onclick = function () {
        const name = plantName.value.trim();
        const products = plantProducts.value.trim();

        if (!name) { alert("Enter plant name"); return; }
        if (!products) { alert("Enter products"); return; }

        const productList = products.split(",").map(x => x.trim()).filter(Boolean);

        plants.push({ name: name, products: productList });

        renderPlants();

        plantName.value = "";
        plantProducts.value = "";
    };

    function renderPlants() {
        plantList.innerHTML = "";

        if (plants.length === 0) {
            plantList.innerHTML = '<div class="subtitle">No plants added yet.</div>';
        }

        plants.forEach((p, i) => {
            plantList.innerHTML += `
                <div class="plant-item">
                    <div>
                        <strong>${p.name}</strong><br />
                        <span class="subtitle">${p.products.join(", ")}</span>
                    </div>
                    <button class="remove-btn" onclick="removePlant(${i})">Remove</button>
                </div>
            `;
        });

        plantsJson.value = JSON.stringify(plants);
        renderSummary();
    }

    function removePlant(i) {
        plants.splice(i, 1);
        renderPlants();
    }

    function renderSummary() {
        if (plants.length === 0) {
            summaryBox.style.display = "none";
            return;
        }

        summaryBox.style.display = "block";

        summaryContent.innerHTML = plants
            .map(p => `<strong>${p.name}:</strong> ${p.products.join(", ")}`)
            .join("<br>");
    }

    document.getElementById("btnClear").onclick = function () {
        plantName.value = "";
        plantProducts.value = "";
    };
</script>
